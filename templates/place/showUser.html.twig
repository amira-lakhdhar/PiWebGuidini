{% extends 'base.html.twig' %}

{% block title %}Place{% endblock %}

{% block body %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
   <center> <h1>Place</h1>
    <div class="row">
        <div class="stars">
            {% if ratings==1 %}
                <i class="las la-star" data-value="1"></i>
                <i class="lar la-star" data-value="2"></i>
                <i class="lar la-star" data-value="3"></i>
                <i class="lar la-star" data-value="4"></i>
                <i class="lar la-star" data-value="5"></i>
            {% elseif ratings==2 %}
                <i class="las la-star" data-value="1"></i>
                <i class="las la-star" data-value="2"></i>
                <i class="lar la-star" data-value="3"></i>
                <i class="lar la-star" data-value="4"></i>
                <i class="lar la-star" data-value="5"></i>
            {% elseif ratings==3 %}
                <i class="las la-star" data-value="1"></i>
                <i class="las la-star" data-value="2"></i>
                <i class="las la-star" data-value="3"></i>
                <i class="lar la-star" data-value="4"></i>
                <i class="lar la-star" data-value="5"></i>
            {% elseif ratings==4 %}
                <i class="las la-star" data-value="1"></i>
                <i class="las la-star" data-value="2"></i>
                <i class="las la-star" data-value="3"></i>
                <i class="las la-star" data-value="4"></i>
                <i class="lar la-star" data-value="5"></i>
            {% elseif ratings==5%}
                <i class="las la-star" data-value="1"></i>
                <i class="las la-star" data-value="2"></i>
                <i class="las la-star" data-value="3"></i>
                <i class="las la-star" data-value="4"></i>
                <i class="las la-star" data-value="5"></i>
                {% else %}

                    <i class="lar la-star" data-value="1"></i>
                    <i class="lar la-star" data-value="2"></i>
                    <i class="lar la-star" data-value="3"></i>
                    <i class="lar la-star" data-value="4"></i>
                    <i class="lar la-star" data-value="5"></i>
            {% endif %}
        </div>

    </div>

    {{ form_start(form) }}
    <div class="my-custom-class-for-errors">
        {{ form_errors(form) }}
    </div>
    <div class="row">
        <div class="col" hidden>
            {{ form_widget(form.rate) }}
        </div>
        <button class="btn">{{ button_label|default('Save Rate') }}</button>

        {{ form_end(form) }}
   </center>
    </div>
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            {% set i = 0 %}
            {% set j = 1 %}
            {% for pic in pictures %}
                {% if j>1 %}
                    {% set i = i + 1 %}
                    <li data-target="#myCarousel" data-slide-to="{{ i }}"></li>
                {% endif %}
                {% set j=j+1 %}
            {% endfor %}
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner">
            <div class="item active">
                <img src="{{ asset('Uploads/'~ pic1.Name) }}" width="150px" height="150px" alt="Los Angeles">
            </div>
            {% set k = 1 %}
            {% for pic in pictures %}
                {% if k>1 %}
                    <div class="item">
                        <img src="{{ asset('Uploads/'~ pic.Name) }}" width="150px" height="150px">
                    </div>
                {% endif %}
                {% set k=k+1 %}
            {% endfor %}
        </div>

        <!-- Left and right controls -->
        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
    <table class="table">
        <tbody>
        <tr>
            <th>type</th>
            <td>{{ place.type }}</td>
        </tr>
        <tr>
            <th>nom</th>
            <td>{{ place.nom }}</td>
        </tr>
        <tr>
            <th>adresse</th>
            <td><a class="btn btn-info" href="{{ path('plcmapPlace',{'id':place.id}) }}">Voire dans la map</a></td>
        </tr>
        <tr>
        </tbody>
    </table>
<h3>Commentaires</h3>
    {{ form_start(form1) }}
    {{ form_widget(form1) }}
    <button class="btn">{{ button_label|default('Save') }}</button>
    {{ form_end(form1) }}


<table class="table">
    <thead>
    <tr>
        <th>User</th>
        <th>Commentaires</th>
        <th> </th>
    </tr>
    </thead>
    <tbody>
    {% for commentaire in comnts %}
        <tr>
            <td>{{ commentaire.user.nom }} {{ commentaire.user.prenom }}</td>
            <td>{{ commentaire.Comnt }}</td>
            <td>
                {% if commentaire.user.id==1 %}
                <a class="btn btn-danger" href="{{ path('commentaire_delete', {'id': commentaire.id,'idP':place.id}) }}">Delete</a>
                <a class="btn btn-info" href="{{ path('commentaire_edit', {'id': commentaire.id,'idP':place.id}) }}">edit</a>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

    <script>

        window.onload = () => {
            // On va chercher toutes les étoiles
            const stars = document.querySelectorAll(".la-star");

            // On va chercher l'input
            const note = document.querySelector("#avis_rate");


            // On boucle sur les étoiles pour le ajouter des écouteurs d'évènements
            for(star of stars){
                // On écoute le survol
                star.addEventListener("mouseover", function(){
                    resetStars();
                    this.style.color = "red";
                    this.classList.add("las");
                    this.classList.remove("lar");
                    // L'élément précédent dans le DOM (de même niveau, balise soeur)
                    let previousStar = this.previousElementSibling;

                    while(previousStar){
                        // On passe l'étoile qui précède en rouge
                        previousStar.style.color = "red";
                        previousStar.classList.add("las");
                        previousStar.classList.remove("lar");
                        // On récupère l'étoile qui la précède
                        previousStar = previousStar.previousElementSibling;
                    }
                });

                // On écoute le clic
                star.addEventListener("click", function(){
                    note.value = this.dataset.value;
                });

                star.addEventListener("mouseout", function(){
                    resetStars(note.value);
                });
            }

            /**
             * Reset des étoiles en vérifiant la note dans l'input caché
             * @param {number} note
             */
            function resetStars(note = 0){
                for(star of stars){
                    if(star.dataset.value > note){
                        star.style.color = "black";
                        star.classList.add("lar");
                        star.classList.remove("las");
                    }else{
                        star.style.color = "red";
                        star.classList.add("las");
                        star.classList.remove("lar");
                    }
                }
            }
        }
    </script>


{% endblock %}